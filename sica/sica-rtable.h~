/* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */
/* 
 * Copyright (c) 2010 Universitat Pollitechnica the Catalunya
 * 
 * 
 * Author: Maryam Amiri Nezhad <maryam@ac.upc.edu>
 * 
 * This is doxygen module description, don't include 
 */

#ifndef RTABLE_H
#define RTABLE_H

/**
 * \ingroup sica
 * \defgroup rtable RTABLE
 * 
 * \brief Routing table structure and functions
 * here we need to manage the routing information using a global routing protocol.
 * 
 */

#include <iostream>
#include <iterator>
#include <ostream>
#include <fstream>
#include <string>
#include <vector>
#include "ns3/node.h"
#include "ns3/object-factory.h"
#include "ns3/object.h"
#include "ns3/double.h"
#include "ns3/integer.h"
#include "ns3/log.h"
#include "ns3/boolean.h"
#include "ns3/type-id.h"
#include "node-container.h"
namespace ns3 {

/**
 * \ingroup rtable
 * 
 * A record of a routing table entry for static routing in Sica 
 */
class SicaRoutingTableEntry{
    public:
  /**
   * \brief This constructor does nothing
   */
  SicaRoutingTableEntry();
  /**
   * \brief Copy Constructor
   * \param route The route to copy
   */
  SicaRoutingTableEntry(SicaRoutingTableEntry const &route);
 /**
   * \brief Copy Constructor
   * \param route The route to copy
   */
  SicaRoutingTableEntry(SicaRoutingTableEntry const *route);
/**
   * \brief Copy Constructor
   * \param dstId destination Id 
   * \param nextHopId  Id of next hop node to the destination
   * \param metric route metric
   */

  SicaRoutingTableEntry(uint32_t srcId, uint32_t dstId, uint32_t nextHopId, double metric);
 /**
   * \return The node id of the source  of this route
   */
  uint32_t GetSrc (void) const;
 /**
   * Set the node id of the source of this route
   */
  void SetSrc(uint32_t srcId);

 /**
   * \return The node id of the destination of this route
   */
  uint32_t GetDest (void) const;
 /**
   * Set the node id of the destination of this route
   */
  void SetDest(uint32_t dstId);
/**
   * \return The node id of the next hop  of this route
   */
  uint32_t GetNextHop (void) const;
/**
   * Set the node id of the next hop of this route
   */
void SetNextHop (uint32_t nextHopId);
/**
   * \return The metric  of  this route
   */
  double GetMetric (void) const;
/**
   * Set the metric  of  this route
   */
void SetMetric (double metric);
private:
  uint32_t m_src;
  uint32_t m_dst;
  uint32_t m_nextHop;
  double  m_metric;
};

std::ostream& operator<< (std::ostream& os, SicaRoutingTableEntry const& route);
/**
 * \ingroup rtable
 * 
 * A  routing table contains a list of routes for static routing in Sica 
 */

class RTable : public Object
{
public:
static TypeId GetTypeId (void);
///c-tor
RTable();
///d-tor
~RTable();
/// Add route to the list 
bool AddRouteToTable(SicaRoutingTableEntry* route);
/// Make a  route to a node with destId from nexthop node and add it to the list 
void MakeRoute(uint32_t srcId,uint32_t dstId, uint32_t nextHopId, double metric);
  /// Find the route entry for the destination node with dstId
SicaRoutingTableEntry* FindRoute(uint32_t srcId,uint32_t dstId);
  /// Find the id of the nexthop node to  the destination node with dstId
int FindNextHop(uint32_t srcId,uint32_t dstId);
  /// Fill the routing tables from file
  void ReadRoutesFromFile(const char* fileName);
  ///Print all content of the routing table
  void PrintRTable(std::ostream &os);
private:
  std::vector<SicaRoutingTableEntry*> m_rTable;
};

/**
 * \ingroup rtable
 * 
 * A  routing helper which reads a routing file and attaches a routing table to a node
 */

/**
 * \ingroup sicahelper
 * \brief Helper class that adds Sica channel assignment  to nodes.
 */

class RoutingHelper
{
public:
  //c_tor
  RoutingHelper();
 /**
   * \param node the node on which this routing will run
   *\param fileName the file which contains routing information
   * \returns a newly-created routing table
   *
   * This method will be called by ns3::RoutingHelper::Install
   * 
   */

  Ptr<RTable> Create (Ptr<Node> node,const char* fileName ) const;

/**
   * \param name the name of the attribute to set
   * \param value the value of the attribute to set.
   *
   * This method controls the attributes of ns3::Sica::Sica
   */

  void Set (std::string name, const AttributeValue &value);
  /**
   * For each node in the input container,implements 
   * ns3::Rtable  The program will assert 
   * if this method is called on a container with a node that already has
   * an Rtable  object aggregated to it.
   * 
   * \param c NodeContainer that holds the set of nodes on which to install the
   * new agent.
   */
  void Install (NodeContainer c, const char* fileName);

private:
  ObjectFactory m_agentFactory;
};

}/*namespace ns3*/


#endif /* RTABLE_H */
